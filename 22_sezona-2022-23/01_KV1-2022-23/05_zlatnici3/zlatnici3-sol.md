---
title: Златници 3 - опис решења
---

## Златници 3

Аутор: Павле Мартиновић 
Текст: и тест примери: Марко Шишовић 
Анализа решења: Павле Мартиновић
Тестирање: Павле Мартиновић

###  Решење у $O(QN^2)$
Покушајмо да пронађемо за сваки чвор $u$ колико треба потеза да бисмо све златнике пренели у њега. Ово је сума $\sum_{i=1}^nd(u,i)\cdot w_i$, где $w_i$ број златника у $i$, а $d(u,v)$ дужина пута између чворова $u$ и $v$. Ово се лако може израчунати пуштањем ДФС из сваког чвора.

###  Решење у $O(QN)$
Потребно је да мало дубље анализирамо који чвор ће бити одговор. Нека са $V_v$ означавамо број потеза који је потребан да би сви златници стигли у чвор $v$. Потребно је наћи чвор тако да је $V_u=\sum_{i=1}^nd(u,i)\cdot w_i$ минимално. Посматрајмо вредност $V_u-V_v$ за неку грану $uv$. Из горенаведене формуле видимо да је ово заправо једнако разлици сума тежина у два стабла која добијемо када исечемо грану $uv$ (уверите се!). Када смо у оптималном чвору, ова вредност треба да буде негативна за све гране, што је еквивалентно са тим да кад исечемо тај чвор, у сваком од добијених стабала је највише пола од укупне тежине (овакав чвор се зове центроидом стабла). Сада лако се види да је овакав чвор јединствен, или их је два која су спојена граном са разликом рењења од $0$ (а у том слулају су оба валидно решење). Стога, свели смо задатак на тражење шта је центроид у овом стаблу, што може да се уради ДФС и чувају се величине свих подстабала, а затим се уради једноставна провера.
### Решење када је стабло пут
У овом случају је решење тернарно претраживо по путу, и све дист функције се могу израчунати лако. Могуће је урадити тад у задатак $O(N\log N + Q\log^2 N)$, за једну тачку претраге у тернарној нам треба само суме по префиксима и суфиксима, а промени тих можемо да пратимо у сегментном стаблу.  
### Решење када је стабло комплетно бинарно
Настављамо на решење из другог подзадатка. Оно што треба приметити је да је вредност $V_v-V_u$ могуће израчунати брзо за неку грану. Заиста ако сместимо чворове у низ по улазном или излазном поретку ДФС, и имамо сегментно стабло над тим низом, пошто ће сви чворови у неком стаблу формирати интервал. Нама је потребна само тежина у два стабла која добихемо кад исечемо ову грану, а једно од тих стабала ће морати да буде подтабло укорењеног стабла. Тежину у другом можемо израчунати као укупна тежина минус то што смо израчунали. Стога, промену резултата проласком из једног чвора у други, (то јест да ли је боље ако пређемо) можемо израчунати у $O(\log N)$.

Сада кад додамо нови чвор, ново решење ће се налазити на путу од тренутног решења до тог новог на који смо додали златнике. Стога, на том путу ће промене резултата бити позитивне, па негативне. Да бисмо решили задатак потребно је само итерирати кроз пут и наћи све гране кроз које кад прођемо побољшавамо резултат. Пошто су на овом стаблу сви путеви кратки, налазимо решење у $O(N\log N + Q\log^2 N)$.
### Решење без додатних ограничења
Коначно решење је мала надоградња претходног. Наиме, уместо да идемо редом по путу између старог и новог чвора, ураидмо бинарну претрагу на том путу да бисмо пронашли последњу грану која нам даје позитиван скор на резултат. По свему описаном у претходном подзадатку, ово ће заиста бити бинарно претраживо и стога ће ово решење радити у $O(N\log N + Q\log^2 N)$.
