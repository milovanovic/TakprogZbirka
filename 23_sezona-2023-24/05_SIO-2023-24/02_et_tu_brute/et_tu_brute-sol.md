

# Et tu, Brute?
Аутор: Павле Мартиновић
Текст и тест примери: Павле Мартиновић
Анализа решења: Павле Мартиновић
Тестирање: Алекса Милисављевић
## Решење када $A[i]\leq 1$
Означимо са $P(i,j)$ број вредности мањих $k$ од $2^{K+1}$ таквих да је $(i+j)\&k=(i\&k)+(j\&k)$. Лако можемо видети да је $P(0,0)=P(0,1)=2^{K+1}$, док се такође релативно лако види да је $P(1,1)=2^K$ (само први и други бит утичу на решење, и они морају или оба бити активна или оба неактивна). Тако да нам је довољно да само нађемо број нула $c_0$ и број јединица $c_1$ и затим брзим степеновањем нађемо $2^{\frac{c_0(c_0+1)}{2}(K+1)+c_0c_1(K+1)+\frac{c_1(c_1+1)}{2}K}$. Сложеност $O(N)$.
## Решење када је $K=3$

Овде имамо само $36$ могућности за $P(i,j)$ које је могуће или наћи ручно на папиру или програмом. Затим на сличан начин као горе, брзим степеновањем и низом који представља број појављивања сваког броја налазимо решење. Сложеност $O(N)$.

## Решење када је $K\leq 8$
У овом подзадатку поступамо слично као у претходном, само $P(i,j)$ налазимо алгоритамски тако што тестирамо свако $k$. Затим опет решење налазимо као производ $P(i,j)^{c_ic_j}$ и $P(i,i)^{\frac{c_i(c_i+1)}{2}}$, што можемо наћи брзим степеновањем. Решење $O(N+K^3+K^2\log N)$.

## Решење када је $N\leq 1.000$

Сада нам је потребан бржи начин за рачунање $P(x,y)$. Запишимо $x$, $y$ и $x+y$ у бинарном запису дужине $K+1$ са водећим нулама. Нека су то $а_{K+1}a_K\ldots a_1$, $b_{K+1}b_K\ldots b_1$, и $c_{K+1}c_K\ldots c_1$ и посматрајмо једначину $0=(x\&k)+(y\&k)-((x+y)\&k)$. Ако је $k_{K+1}k_{K}\ldots k_1$ бинарни запис броја $k$ вредност леве стране јединачине би била сума $v_i=k_i(a_i+b_i-c_i)\cdot 2^i$, а вредност $a_i+b_i-c_i$ је у скупу $\{-1,0,1,2\}$. Посматрајмо највеће $i$ тако да је $v_i\neq 0$. Уколико је $v_i>0$ знамо да је $v_i\ge 2^i$ и $v_j\ge-2^j$ за $j\leq i$, те је сума $v_i$ позитивна што није могуће. Стога је $v_i=-2^i$. Ово је једино могуће уколико постоји пренос на позицији $i-1$ и $a_i=b_i=0$. Даље $k_{i-1}\cdot(a_{i-1}+b_{i-1}-c_{i-1}),k_{i-2}\cdot(a_{i-2}+b_{i-2}-c_{i-2}),\ldots$ морају бити (до неке позиције) $1,1,1,1,1\ldots,2$. Можемо индуктивно доказати да ако су до сад биле јединице, следећа цифра је или $1$ или $2$ (ако би била $0$ или $-1$ онда због величине, слично претходном разматрању, $k$ не би било решење). Уколико је $1$ наставимо индукцију, уколико је $2$ видимо да овај цео блок има величину $0$ те можемо да га избацимо и разматрамо мање скупове. Сада смо добили вредности $v_i$ у неком блоку $k$ где сви $k_i$ морају бити $1$, па хајде да размотримо како то мора да изгледа за те битове за $x,y$. Neka je $p_{K+1}p_{K}\ldots p_1$ низ преноса. Лако се може видети (индукцијом, на пример) да ако је горњи блок од $i$ до $j$ онда мора да важи да је $p_i=p_{i-1}=p_{i-2}=\ldots=p_{j+1}=1$ и $p_j=0$. Већ смо видели да пошто је $v_i$ негативан, мора да је $a_i=b_i=0$ i $p_i=1$ тако да је и $p_{i+1}=0$. Тако да блок кечева узетих у бинарном запису од $k$ мора почињати од неког места где нема пренос и ићи до следећег места где нема пренос. Из претходног се може закључити да уколико поделимо низ $p$ на блокове облика $1111\ldots110$, ако узмемо један елемент из тог блока морамо да узмемо цео блок, а лако се може видети да је сума у свако  блоку  $0$, без обзира да ли смо узели све нуле или све јединице. Стога је $P(i,j)=2^{\text{број таквих блокова}}$, односно $P(i,j)=2^{\text{број позиција у где нема пренос}}$, тако да га можемо лако израчунати за сваки пар и помножити. Сложеност $O(N^2K)$.
## Решење када је $N\leq 100.000$
Уколико је $A$ одговор који тражимо, приметимо да је $\log_2(A)$ број тројки $(i,j,k)$ тако да $a_i+a_j$ нема пренос на позцији $k$. Ако фиксирамо $k$, да бисмо нашли број парова који немају пренос на тој позицији, можемо да узмемо низ по модулу $2^k$ (и добијемо низ $b_i$) и онда нам треба број парова тако да је $b_i+b_j<2^k$, што се може урадити сортирањем и бинарном претрагом. Затим само нађемо решење брзим степеновањем. Сложеност $O(NK\log N)$.

## Главно решење
У претходном решењу, фактор $\log N$ у решењу долази из две ствари: сортирања и бинарне претраге. Пошто је низ сортиран, бинарну претрагу можемо лако заменити техником два показивача да би радило у $O(N)$ у свакој од $K$ итерација. Сортирање свакако захтева $N\log N$ времена, али је трик да следећи сортиран низ можемо добити од претходног. Заиста, у прелазу $k\rightarrow k+1$ сваки $b_i$ или остане исти или или се повећа за $2^k$. Сви који су се повећали постају већи од свих који нису, а осталима паровима релативни поредак остаје исти. Стога ако у сваком тренутку памтимо и од ког елемента је неки $b_i$ „потекао“ лако можемо израчунати нови низ, и користити то што нам је тренутни већ сортиран да бисмо сортирали нови у линеарном времену (прођемо кроз низ двапут и први пут издвојимо оне које се нису повећали а у другом оне који јесу). Ово је у суштини алгоритам сортирања "radix-sort". Сложеност $O(NK)$. 
